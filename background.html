
<html>
<head>
<script src="jquery-1.10.0.min.js"></script>
<script src="http://www.google.com/jsapi"></script>
<script src="background.js"></script>
<script type="text/javascript">
google.load("feeds", "1");
function initialize() {

    getWeatherInfomation("400010", 1);

}

function getWeatherInfomation(cd, type) {
    var feedurl = 
        "http://weather.livedoor.com/forecast/rss/area/" + cd + ".xml";
    var feed = new google.feeds.Feed(feedurl);
    feed.setResultFormat(google.feeds.Feed.XML_FORMAT);
    feed.setNumEntries(10);
    feed.load(function (result){
        if (!result.error){
            var items = result.xmlDocument.getElementsByTagName('item');
            if (type == 1) {
                ery = getHeadObject(items);
                img = getImage(ery, "url");
                // setChromeIcon({"path":img});
                console.log(img);
            }
        }else {
            console.log("天気情報の取得に失敗しました");
        }
    });
}

function getHeadObject(data) {
    if(data && data.length > 0) {
        return data[1];
    }
    return null;
}

function getWeatherState(entry) {
    var title = 
        entry.getElementsByTagName('title')[0].firstChild.nodeValue;
    if (title != null || title.length != 0) {
        return getValue(title, 1);
    }
}

function getWeatherDegree(entry) {
    var title = 
        entry.getElementsByTagName('title')[0].firstChild.nodeValue;
    if (title != null || title.length != 0) {
        return getValue(title, 2);
    }
}

function getWeatherDate(entry) {
    var title = 
        entry.getElementsByTagName('title')[0].firstChild.nodeValue;
    if (title != null || title.length != 0) {
        return getValue(title, 3);
    }
}

function getValue(str, index) {
    var array = str.split("-");
    if (index < array.length) {
        work = array[index];
        return work.replace(/(^\s+)|(\s+$)/g, "");
    }
    return "";
}

function getValueFromImage(entry, name) {
    var image =
        entry.getElementsByTagName('image')[0];
    var value = 
        image.getElementsByTagName(name)[0].firstChild.nodeValue;
    return value;
}

function getFileName(file_path) {  
    file_name = file_path.substring(file_path.lastIndexOf('/')+1, file_path.length);  
    return file_name;  
}  

function getImage(entry) {
    var path = getValueFromImage(entry, "url");
    return getFileName(path).replace(".gif", ".png");;
}

function getLink(entry) {
    return getValueFromImage(entry, "link");
}

/**
 * Decision type of variable.
 * @class Type
 * @static
 */
var Type = {
  isObject: function(v) {
    return (Object.prototype.toString.call(v) == "[object Object]");
  },
  isFunction: function(v) {
    return (Object.prototype.toString.call(v) == "[object Function]");
  },
  isArray: function(v) {
    return (Object.prototype.toString.call(v) == "[object Array]");
  },
  isBoolean: function(v) {
    return (Object.prototype.toString.call(v) === "[object Boolean]");
  },
  isString: function(v) {
    return (Object.prototype.toString.call(v) === "[object String]");
  },
  isNumber: function(v) {
    return (Object.prototype.toString.call(v) === "[object Number]");
  },
  isElement: function(v) {
    var check = false;
    switch(Object.prototype.toString.call(v)) {
      case "[object Object]":
        if (v.length) check = true;
        break;
      case "[object Window]":
      case "[object HTMLParagraphElement]":
        if (! Type.isUndefined(v) && ! Type.isNull(v)) check = true;
        break;
      default:
        break;
    }
    return check;
  },
  isElementCollection: function(v) {
    return (Object.prototype.toString.call(v) === "[object HTMLCollection]");
  },
  isNull: function(v) {
    return (v === null);
  },
  isUndefined: function(v) {
    return (v === 'undefined');
  },
  /**
   * @method getType
   * @param {Any} v The variable
   * @return {String} type of the variable
   */
  getType: function(v) {
    if (Type.isNull(v)) { return "null"; }
    if (Type.isUndefined(v)) { return "undefined"; }
    if (Type.isElement(v)) { return "HTMLElement"; }
    return Object.prototype.toString.call(v).split(" ")[1].replace("]", "");
  }
};
chrome.browserAction.onClicked.addListener(alert(""));
google.setOnLoadCallback(initialize);
</script>
</head>
<body>
<div id="output"></div>
</body>
</html>
